{% load edit_tags %}
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baza Pracownik√≥w</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin: 0 0 10px 0;
        }
        .user-info {
            text-align: center;
            color: #666;
            margin-bottom: 10px;
        }
        .logout-link {
            text-align: center;
            margin-top: 10px;
        }
        .logout-link a {
            color: #007bff;
            text-decoration: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 14px;
            table-layout: auto;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            white-space: nowrap;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            border-right: 1px solid #dee2e6;
        }
        td {
            border-right: 1px solid #dee2e6;
        }
        th:last-child, td:last-child {
            border-right: none;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .info {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
        .current-user {
            background-color: #fff3cd;
        }
        .sortable {
            color: #007bff;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .sortable:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        .sort-controls {
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .role-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            color: white;
            background-color: #6c757d;
        }
        .role-badge.admin {
            background-color: #dc3545;
        }
        .role-badge.hr {
            background-color: #fd7e14;
        }
        .role-badge.ceo {
            background-color: #6f42c1;
        }
        .role-badge.kierownik {
            background-color: #198754;
        }
        .role-badge.pracownik {
            background-color: #0d6efd;
        }
        .team-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            color: white;
            background-color: #6c757d;
        }
        .team-badge.brak {
            background-color: #393e3f;
            color: white;
        }
        .team-badge.mixed-team {
            background-color: #ff00d0;
            color: white;
        }
        .team-badge.bus-it-systems {
            background-color: #04195b;
            color: white;
        }
        .team-badge.hr {
            background-color: #37eb40;
            color: white;
        }
        
        /* Style dla edycji inline */
        .editable-cell {
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .editable-cell:hover {
            background-color: #f8f9fa;
        }
        .edit-form {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin: 0;
        }
        .edit-input {
            border: 2px solid #007bff;
            padding: 4px 8px;
            font-size: 14px;
            border-radius: 4px;
            background: white;
            min-width: 100px;
        }
        .edit-actions {
            display: inline-flex;
            gap: 2px;
        }
        .edit-btn {
            border: none;
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.2s;
        }
        .save-btn {
            background-color: #28a745;
            color: white;
        }
        .save-btn:hover {
            background-color: #218838;
        }
        .cancel-btn {
            background-color: #dc3545;
            color: white;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .cancel-btn:hover {
            background-color: #c82333;
            color: white;
            text-decoration: none;
        }
        .edit-link {
            color: inherit;
            text-decoration: none;
            display: block;
            width: 100%;
            height: 100%;
        }
        .edit-link:hover {
            color: inherit;
            text-decoration: none;
        }
        
        /* Komunikaty */
        .messages {
            margin: 20px 0;
        }
        .message {
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Style dla przycisk√≥w akcji */
        .action-buttons {
            margin: 20px 0;
            text-align: center;
            display: flex; /* U≈ºyj flexbox dla wyr√≥wnania */
            justify-content: center; /* Wy≈õrodkuj przyciski */
            flex-wrap: wrap; /* Zawijaj przyciski na mniejszych ekranach */
            gap: 10px; /* Odstƒôp miƒôdzy przyciskami */
        }
        .action-button { /* Og√≥lny styl dla wszystkich przycisk√≥w akcji */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        .action-button:hover {
            opacity: 0.9; /* Lekkie przyciemnienie przy najechaniu */
        }

        /* Specyficzne kolory dla przycisk√≥w */
        .add-employee-btn {
            background-color: #28a745; /* Zielony */
        }
        .add-employee-btn:hover {
            background-color: #218838;
        }

        .add-stanowisko-btn {
            background-color: #007bff; /* Niebieski */
        }
        .add-stanowisko-btn:hover {
            background-color: #0056b3;
        }

        .add-rola-btn {
            background-color: #ffc107; /* ≈ª√≥≈Çty */
            color: #333; /* Ciemny tekst dla lepszego kontrastu */
        }
        .add-rola-btn:hover {
            background-color: #e0a800;
        }

        .add-zespol-btn {
            background-color: #6f42c1; /* Fioletowy */
        }
        .add-zespol-btn:hover {
            background-color: #5a32a3;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        
        /* Style dla formularza dodawania */
        .add-form-container { /* Nowa klasa dla og√≥lnego kontenera formularzy */
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: none; /* Domy≈õlnie ukryty */
        }
        .add-form-container.active {
            display: block;
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-actions {
            text-align: center;
            margin-top: 20px;
        }
        .form-actions button {
            margin: 0 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .submit-btn {
            background-color: #007bff;
            color: white;
        }
        .submit-btn:hover {
            background-color: #0056b3;
        }
        .cancel-form-btn {
            background-color: #6c757d;
            color: white;
        }
        .cancel-form-btn:hover {
            background-color: #545b62;
        }
        
        /* Styles for WebSocket notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideIn 0.3s ease-out;
        }
        
        .notification-success {
            background-color: #28a745;
        }
        
        .notification-info {
            background-color: #17a2b8;
        }
        
        .notification-warning {
            background-color: #ffc107;
            color: #333;
        }
        
        .notification-error {
            background-color: #dc3545;
        }
        
        .notification button {
            background: none;
            border: none;
            color: inherit;
            font-size: 18px;
            cursor: pointer;
            margin-left: 10px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Style dla systemu powiadomie≈Ñ */
        .notification-item {
            background: white;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            animation: slideInNotification 0.5s ease-out;
        }
        
        .notification-item.birthday_today {
            border-left-color: #e91e63;
            background: linear-gradient(to right, #ffeaa7, #fab1a0);
        }
        
        .notification-item.birthday_tomorrow {
            border-left-color: #ff9800;
            background: linear-gradient(to right, #a29bfe, #fd79a8);
        }
        
        .notification-item.work_anniversary {
            border-left-color: #4caf50;
            background: linear-gradient(to right, #00b894, #00cec9);
        }
        
        .notification-item.new_employee {
            border-left-color: #2196f3;
            background: linear-gradient(to right, #74b9ff, #0984e3);
        }
        
        .notification-icon {
            font-size: 24px;
            margin-right: 15px;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.3));
        }
        
        .notification-content {
            flex: 1;
            color: #333;
        }
        
        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .notification-message {
            font-size: 14px;
            opacity: 0.9;
        }
        
        @keyframes slideInNotification {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Chat styles */
        .chat-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-top: 20px;
            padding: 20px;
        }
        
        .chat-header {
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .chat-messages {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        
        .chat-message {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid #007bff;
            padding-left: 10px;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
        }
        
        .chat-input-container input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .chat-input-container button {
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .chat-input-container button:hover {
            background-color: #0056b3;
        }
        
        /* Statystyki Dashboard */
        .dashboard-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 20px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .dashboard-title {
            color: #333;
            margin: 0;
            font-size: 24px;
        }
        
        .dashboard-controls {
            display: flex;
            gap: 10px;
        }
        
        .dashboard-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        
        .dashboard-btn:hover {
            background-color: #0056b3;
            color: white;
            text-decoration: none;
        }
        
        .dashboard-btn.pdf {
            background-color: #dc3545;
        }
        
        .dashboard-btn.pdf:hover {
            background-color: #c82333;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        
        .stat-title {
            font-size: 14px;
            color: #666;
            margin: 0 0 10px 0;
            font-weight: bold;
        }
        
        .stat-value {
            font-size: 24px;
            color: #333;
            margin: 0;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        
        .chart-title {
            font-size: 16px;
            color: #333;
            margin: 0 0 15px 0;
            text-align: center;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .last-update {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    </div>
    <div style="margin-top: 80px;">
    
    <div class="header">
        <h1>Baza Pracownik√≥w</h1>
        {% if current_user %}
            <div class="user-info">
                <strong>Zalogowano jako:</strong> {{ current_user.imie }} {{ current_user.nazwisko }} 
                <span class="role-badge {{ current_user.rola }}">{{ user_role }}</span>
            </div>
        {% endif %}
        <div class="logout-link">
            <a href="/accounts/logout/">Wyloguj siƒô</a>
            {% if current_user and current_user.rola == 'admin' %}
                | <a href="/admin/">Panel Admin</a>
            {% endif %}
        </div>
    </div>
    
    <!-- Wy≈õwietlanie komunikat√≥w -->
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
    
    <!-- Przyciski akcji -->
    <div class="action-buttons">
        {% if can_add_employees %}
            <button onclick="toggleForm('addEmployeeForm', 'addButton')" class="action-button add-employee-btn" id="addButton">+ Dodaj pracownika</button>
        {% endif %}
        <button type="button" id="addStanowiskoButton" onclick="toggleForm('addStanowiskoForm', 'addStanowiskoButton')" class="action-button add-stanowisko-btn">+ Dodaj stanowisko</button>
        <button type="button" id="addRolaButton" onclick="toggleForm('addRolaForm', 'addRolaButton')" class="action-button add-rola-btn">+ Dodaj rolƒô</button>
        <button type="button" id="addZespolButton" onclick="toggleForm('addZespolForm', 'addZespolButton')" class="action-button add-zespol-btn">+ Dodaj zesp√≥≈Ç</button>
        
        <!-- Nowe przyciski statystyk i raport√≥w -->
        <a href="{% url 'dashboard_page' %}" class="action-button" style="background-color: #17a2b8; text-decoration: none; color: white;">üìä Statystyki</a>
        {% if current_user.rola == 'admin' or current_user.rola == 'hr' %}
            <a href="{% url 'generate_pdf_report' %}" class="action-button" style="background-color: #dc3545; text-decoration: none; color: white;">üìÑ Raport PDF</a>
        {% endif %}
        
        <!-- Przycisk systemu obecno≈õci -->
        <a href="{% url 'system_obecnosci' %}" class="action-button" style="background-color: #28a745; text-decoration: none; color: white;">üïê System obecno≈õci</a>
        
        <!-- Bezpo≈õredni link do pokoju g≈Çosowego -->
        <a href="/voice/general/" class="action-button" style="background-color: #6f42c1; text-decoration: none; color: white;">üé§ Pok√≥j G≈Çosowy</a>
        
        <!-- System zada≈Ñ -->
        <a href="{% url 'zadania_view' %}" class="action-button" style="background-color: #20c997; text-decoration: none; color: white;">üìù Zadania</a>
        
        <!-- System ocen 360¬∞ -->
        <a href="{% url 'oceny_pracownikow' %}" class="action-button" style="background-color: #fd7e14; text-decoration: none; color: white;">‚≠ê Oceny 360¬∞</a>
    </div>
    
    <!-- System powiadomie≈Ñ -->
    <div id="notifications-container" style="margin: 20px 0;">
        <!-- Powiadomienia bƒôdƒÖ ≈Çadowane dynamicznie -->
    </div>
    <!-- Formularz dodawania pracownika -->
    {% if can_add_employees %}
        <div class="add-form-container" id="addEmployeeForm">
            <h3>Dodaj nowego pracownika</h3>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="add">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="imie">Imiƒô *</label>
                        <input type="text" id="imie" name="imie" required>
                    </div>
                    <div class="form-group">
                        <label for="nazwisko">Nazwisko *</label>
                        <input type="text" id="nazwisko" name="nazwisko" required>
                    </div>
                    <div class="form-group">
                        <label for="pesel">PESEL *</label>
                        <input type="text" id="pesel" name="pesel" pattern="[0-9]{11}" maxlength="11" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="stanowisko">Stanowisko *</label>
                        <select id="stanowisko" name="stanowisko" required>
                            <option value="">Wybierz stanowisko</option>
                            {% for choice in stanowisko_choices %}
                                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="rola">Rola *</label>
                        <select id="rola" name="rola" required>
                            <option value="">Wybierz rolƒô</option>
                            {% for choice in role_choices %}
                                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="zespol">Zesp√≥≈Ç</label>
                        <select id="zespol" name="zespol">
                            <option value="">Brak zespo≈Çu</option>
                            {% for choice in team_choices %}
                                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="przelozony">Prze≈Ço≈ºony</label>
                        <select id="przelozony" name="przelozony">
                            <option value="">Brak prze≈Ço≈ºonego</option>
                            {% for pracownik in all_pracownicy %}
                                <option value="{{ pracownik.id }}">{{ pracownik.nazwisko }} {{ pracownik.imie }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dzial">Dzia≈Ç</label>
                        <input type="text" id="dzial" name="dzial">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="data_zatrudnienia">Data zatrudnienia *</label>
                        <input type="date" id="data_zatrudnienia" name="data_zatrudnienia" required>
                    </div>
                    <div class="form-group">
                        <label for="data_urodzenia">Data urodzenia *</label>
                        <input type="date" id="data_urodzenia" name="data_urodzenia" required>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="submit-btn">Dodaj pracownika</button>
                    <button type="button" onclick="toggleForm('addEmployeeForm', 'addButton')" class="cancel-form-btn">Anuluj</button>
                </div>
            </form>
        </div>
    {% endif %}
    
    <!-- Formularz dodawania stanowiska -->
    <div class="add-form-container" id="addStanowiskoForm">
        <h3>Dodaj nowe stanowisko</h3>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_stanowisko">
            <div class="form-row">
                <div class="form-group">
                    <label for="nazwa_stanowiska">Nazwa stanowiska *</label>
                    <input type="text" id="nazwa_stanowiska" name="nazwa_stanowiska" required>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="submit-btn">Dodaj stanowisko</button>
                <button type="button" onclick="toggleForm('addStanowiskoForm', 'addStanowiskoButton')" class="cancel-form-btn">Anuluj</button>
            </div>
        </form>
    </div>

    <!-- Formularz dodawania roli -->
    <div class="add-form-container" id="addRolaForm">
        <h3>Dodaj nowƒÖ rolƒô</h3>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_rola">
            <div class="form-row">
                <div class="form-group">
                    <label for="nazwa_roli">Nazwa roli *</label>
                    <input type="text" id="nazwa_roli" name="nazwa_roli" required placeholder="np. Specjalista HR">
                </div>
                <div class="form-group">
                    <label for="kod_roli">Kod roli (np. admin, hr) *</label>
                    <input type="text" id="kod_roli" name="kod_roli" required placeholder="np. hr_spec">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="poziom_uprawnien">Poziom uprawnie≈Ñ *</label>
                    <select id="poziom_uprawnien" name="poziom_uprawnien" required>
                        <option value="0">0 - Administrator (najwy≈ºszy poziom)</option>
                        <option value="1">1 - Kierownictwo wysokie (CEO, CTO)</option>
                        <option value="2">2 - HR i zarzƒÖdzanie</option>
                        <option value="3">3 - Kierownictwo ≈õrednie (kierownik dzia≈Çu)</option>
                        <option value="4">4 - Kierownictwo niskie (team leader)</option>
                        <option value="5">5 - Specjalista</option>
                        <option value="6" selected>6 - Pracownik podstawowy</option>
                        <option value="7">7 - Sta≈ºysta (najni≈ºszy poziom)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="opis_roli">Opis (opcjonalny)</label>
                    <textarea id="opis_roli" name="opis_roli" rows="2" placeholder="Kr√≥tki opis roli i uprawnie≈Ñ"></textarea>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="submit-btn">Dodaj rolƒô</button>
                <button type="button" onclick="toggleForm('addRolaForm', 'addRolaButton')" class="cancel-form-btn">Anuluj</button>
            </div>
        </form>
    </div>

    <!-- Formularz dodawania zespo≈Çu -->
    <div class="add-form-container" id="addZespolForm">
        <h3>Dodaj nowy zesp√≥≈Ç</h3>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_zespol">
            <div class="form-row">
                <div class="form-group">
                    <label for="nazwa_zespolu">Nazwa zespo≈Çu *</label>
                    <input type="text" id="nazwa_zespolu" name="nazwa_zespolu" required placeholder="np. HR">
                </div>
                <div class="form-group">
                    <label for="kod_zespolu">Kod zespo≈Çu (np. hr, it) *</label>
                    <input type="text" id="kod_zespolu" name="kod_zespolu" required placeholder="np. hr">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group" style="grid-column: span 2;">
                    <label for="opis_zespolu">Opis (opcjonalny)</label>
                    <textarea id="opis_zespolu" name="opis_zespolu" rows="2" placeholder="Kr√≥tki opis zespo≈Çu i jego funkcji"></textarea>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="submit-btn">Dodaj zesp√≥≈Ç</button>
                <button type="button" onclick="toggleForm('addZespolForm', 'addZespolButton')" class="cancel-form-btn">Anuluj</button>
            </div>
        </form>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Lp.</th>
                <th>
                    <a href="?sort=id&order={% if current_sort == 'id' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="sortable">
                        ID
                        {% if current_sort == 'id' %}
                            <span class="sort-icon">{% if current_order == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}</span>
                        {% endif %}
                    </a>
                </th>
                <th>Zdjƒôcie</th>
                <th>
                    <a href="?sort=imie&order={% if current_sort == 'imie' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="sortable">
                        Imiƒô
                        {% if current_sort == 'imie' %}
                            <span class="sort-icon">{% if current_order == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}</span>
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="?sort=nazwisko&order={% if current_sort == 'nazwisko' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="sortable">
                        Nazwisko
                        {% if current_sort == 'nazwisko' %}
                            <span class="sort-icon">{% if current_order == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}</span>
                        {% endif %}
                    </a>
                </th>
                <th>PESEL</th>
                <th>
                    <a href="?sort=stanowisko&order={% if current_sort == 'stanowisko' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="sortable">
                        Stanowisko
                        {% if current_sort == 'stanowisko' %}
                            <span class="sort-icon">{% if current_order == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}</span>
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="?sort=rola&order={% if current_sort == 'rola' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="sortable">
                        Rola
                        {% if current_sort == 'rola' %}
                            <span class="sort-icon">{% if current_order == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}</span>
                        {% endif %}
                    </a>
                </th>
                <th>Zesp√≥≈Ç</th>
                <th>Prze≈Ço≈ºony</th>
                <th>Dzia≈Ç</th>
                <th>
                    <a href="?sort=zarobki&order={% if current_sort == 'zarobki' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="sortable">
                        Zarobki (brutto)
                        {% if current_sort == 'zarobki' %}
                            <span class="sort-icon">{% if current_order == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}</span>
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="?sort=data_zatrudnienia&order={% if current_sort == 'data_zatrudnienia' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="sortable">
                        Data zatrudnienia
                        {% if current_sort == 'data_zatrudnienia' %}
                            <span class="sort-icon">{% if current_order == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}</span>
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="?sort=data_urodzenia&order={% if current_sort == 'data_urodzenia' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="sortable">
                        Data urodzenia
                        {% if current_sort == 'data_urodzenia' %}
                            <span class="sort-icon">{% if current_order == 'asc' %}‚ñ≤{% else %}‚ñº{% endif %}</span>
                        {% endif %}
                    </a>
                </th>
                <th>Data utworzenia</th>
                <th>Data modyfikacji</th>
                {% if can_delete_employees %}
                    <th>Akcje</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for pracownik in pracownicy %}
            <tr {% if current_user and pracownik.id == current_user.id %}class="current-user"{% endif %}>
                <td>{{ forloop.counter }}</td>
                <!-- Kom√≥rka ID - edytowalna tylko dla admina -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'id' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="id">
                            <input type="number" 
                                   name="field_value" 
                                   value="{{ pracownik.id }}" 
                                   class="edit-input"
                                   autofocus
                                   min="1"
                                   step="1">
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'id' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'id' %}" class="edit-link">{{ pracownik.id }}</a>
                        {% else %}
                            {{ pracownik.id }}
                        {% endif %}
                    {% endif %}
                </td>
                
                <!-- Kom√≥rka zdjƒôcie -->
                <td style="text-align: center; width: 60px;">
                    {% if pracownik.zdjecie %}
                        <img src="{{ pracownik.zdjecie.url }}" alt="Zdjƒôcie {{ pracownik.imie }}" 
                             style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #e9ecef;">
                    {% else %}
                        <div style="width: 40px; height: 40px; border-radius: 50%; background-color: #e9ecef; display: flex; align-items: center; justify-content: center; margin: 0 auto; border: 2px solid #e9ecef;">
                            <span style="color: #6c757d; font-size: 20px;">üë§</span>
                        </div>
                    {% endif %}
                </td>
                
                <!-- Kom√≥rka imiƒô - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'imie' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="imie">
                            <input type="text" 
                                   name="field_value" 
                                   value="{{ pracownik.imie }}" 
                                   class="edit-input"
                                   autofocus>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'imie' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'imie' %}" class="edit-link">{{ pracownik.imie }}</a>
                        {% else %}
                            {{ pracownik.imie }}
                        {% endif %}
                    {% endif %}
                </td>
                <!-- Kom√≥rka nazwisko - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'nazwisko' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="nazwisko">
                            <input type="text" 
                                   name="field_value" 
                                   value="{{ pracownik.nazwisko }}" 
                                   class="edit-input"
                                   autofocus>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'nazwisko' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'nazwisko' %}" class="edit-link">{{ pracownik.nazwisko }}</a>
                        {% else %}
                            {{ pracownik.nazwisko }}
                        {% endif %}
                    {% endif %}
                </td>
                <!-- Kom√≥rka PESEL - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'pesel' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="pesel">
                            <input type="text" 
                                   name="field_value" 
                                   value="{{ pracownik.pesel }}" 
                                   class="edit-input"
                                   autofocus
                                   maxlength="11">
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'pesel' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'pesel' %}" class="edit-link">{{ pracownik.pesel }}</a>
                        {% else %}
                            {{ pracownik.pesel }}
                        {% endif %}
                    {% endif %}
                </td>
                <!-- Kom√≥rka stanowisko - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'stanowisko' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="stanowisko">
                            <select name="field_value" class="edit-input" autofocus>
                                <option value="">Wybierz stanowisko</option>
                                {% for stanowisko_code, stanowisko_name in stanowisko_choices %}
                                    <option value="{{ stanowisko_code }}" {% if pracownik.stanowisko == stanowisko_code %}selected{% endif %}>
                                        {{ stanowisko_name }}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% can_edit_field request pracownik.id 'stanowisko' as can_edit_stanowisko %}
                        {% if can_edit_stanowisko %}
                            <a href="{% edit_url request pracownik.id 'stanowisko' %}" class="edit-link">{{ pracownik.get_stanowisko_display }}</a>
                        {% else %}
                            {{ pracownik.get_stanowisko_display }}
                        {% endif %}
                    {% endif %}
                </td>
                <!-- Kom√≥rka rola - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'rola' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="rola">
                            <select name="field_value" class="edit-input" autofocus>
                                <option value="">Wybierz rolƒô</option>
                                {% for role_code, role_name in role_choices %}
                                    <option value="{{ role_code }}" {% if pracownik.rola == role_code %}selected{% endif %}>
                                        {{ role_name }}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% can_edit_field request pracownik.id 'rola' as can_edit_rola %}
                        {% if can_edit_rola %}
                            <a href="{% edit_url request pracownik.id 'rola' %}" class="edit-link">
                                <span class="role-badge {{ pracownik.rola }}">{{ pracownik.get_rola_display }}</span>
                            </a>
                        {% else %}
                            <span class="role-badge {{ pracownik.rola }}">{{ pracownik.get_rola_display }}</span>
                        {% endif %}
                    {% endif %}
                </td>
                <!-- Kom√≥rka zesp√≥≈Ç - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'zespol' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="zespol">
                            <select name="field_value" class="edit-input" autofocus>
                                <option value="">Brak zespo≈Çu</option>
                                {% for team_code, team_name in team_choices %}
                                    <option value="{{ team_code }}" {% if pracownik.zespol == team_code %}selected{% endif %}>
                                        {{ team_name }}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% can_edit_field request pracownik.id 'zespol' as can_edit_zespol %}
                        {% if can_edit_zespol %}
                            <a href="{% edit_url request pracownik.id 'zespol' %}" class="edit-link">
                                {% if pracownik.zespol %}
                                    {% if pracownik.get_zespol_display_name == "Mixed Team" %}
                                        <span class="team-badge mixed-team">{{ pracownik.get_zespol_display_name }}</span>
                                    {% elif pracownik.get_zespol_display_name == "Bus IT Systems" %}
                                        <span class="team-badge bus-it-systems">{{ pracownik.get_zespol_display_name }}</span>
                                    {% elif pracownik.get_zespol_display_name == "HR" %}
                                        <span class="team-badge hr">{{ pracownik.get_zespol_display_name }}</span>
                                    {% else %}
                                        <span class="team-badge">{{ pracownik.get_zespol_display_name }}</span>
                                    {% endif %}
                                {% else %}
                                    <span class="team-badge brak">Brak zespo≈Çu</span>
                                {% endif %}
                            </a>
                        {% else %}
                            {% if pracownik.zespol %}
                                {% if pracownik.get_zespol_display_name == "Mixed Team" %}
                                    <span class="team-badge mixed-team">{{ pracownik.get_zespol_display_name }}</span>
                                {% elif pracownik.get_zespol_display_name == "Bus IT Systems" %}
                                    <span class="team-badge bus-it-systems">{{ pracownik.get_zespol_display_name }}</span>
                                {% elif pracownik.get_zespol_display_name == "HR" %}
                                    <span class="team-badge hr">{{ pracownik.get_zespol_display_name }}</span>
                                {% else %}
                                    <span class="team-badge">{{ pracownik.get_zespol_display_name }}</span>
                                {% endif %}
                            {% else %}
                                <span class="team-badge brak">Brak zespo≈Çu</span>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
                
                <!-- Kom√≥rka prze≈Ço≈ºony - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'przelozony' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="przelozony">
                            <select name="field_value" class="edit-input" autofocus>
                                <option value="">Brak prze≈Ço≈ºonego</option>
                                {% for p in pracownicy %}
                                    {% if p.id != pracownik.id %}
                                        <option value="{{ p.id }}" {% if pracownik.przelozony and pracownik.przelozony.id == p.id %}selected{% endif %}>
                                            {{ p.imie }} {{ p.nazwisko }} ({{ p.get_rola_display }})
                                        </option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'przelozony' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'przelozony' %}" class="edit-link">
                                {% if pracownik.przelozony %}
                                    {{ pracownik.przelozony.imie }} {{ pracownik.przelozony.nazwisko }}
                                {% else %}
                                    Brak prze≈Ço≈ºonego
                                {% endif %}
                            </a>
                        {% else %}
                            {% if pracownik.przelozony %}
                                {{ pracownik.przelozony.imie }} {{ pracownik.przelozony.nazwisko }}
                            {% else %}
                                Brak prze≈Ço≈ºonego
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
                
                <!-- Kom√≥rka dzia≈Ç - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'dzial' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="dzial">
                            <input type="text" 
                                   name="field_value" 
                                   value="{{ pracownik.dzial|default:'' }}" 
                                   placeholder="Np. Dzia≈Ç 1"
                                   class="edit-input"
                                   autofocus>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'dzial' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'dzial' %}" class="edit-link">
                                {{ pracownik.dzial|default:"Brak dzia≈Çu" }}
                            </a>
                        {% else %}
                            {{ pracownik.dzial|default:"Brak dzia≈Çu" }}
                        {% endif %}
                    {% endif %}
                </td>
                
                <!-- Kom√≥rka zarobki - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'zarobki' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="zarobki">
                            <input type="number" 
                                   name="field_value" 
                                   value="{{ pracownik.zarobki }}" 
                                   class="edit-input"
                                   step="0.01"
                                   min="0"
                                   placeholder="Kwota w PLN"
                                   autofocus>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'zarobki' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'zarobki' %}" class="edit-link">
                                {% if pracownik.zarobki %}
                                    {{ pracownik.zarobki|floatformat:2 }} PLN
                                {% else %}
                                    <span style="color: #999;">Nie podano</span>
                                {% endif %}
                            </a>
                        {% else %}
                            {% if pracownik.zarobki %}
                                {{ pracownik.zarobki|floatformat:2 }} PLN
                            {% else %}
                                <span style="color: #999;">Nie podano</span>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
                
                <!-- Kom√≥rka data zatrudnienia - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'data_zatrudnienia' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="data_zatrudnienia">
                            <input type="date" 
                                   name="field_value" 
                                   value="{{ pracownik.data_zatrudnienia|date:'Y-m-d' }}" 
                                   class="edit-input"
                                   autofocus>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'data_zatrudnienia' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'data_zatrudnienia' %}" class="edit-link">{{ pracownik.data_zatrudnienia }}</a>
                        {% else %}
                            {{ pracownik.data_zatrudnienia }}
                        {% endif %}
                    {% endif %}
                </td>
                <!-- Kom√≥rka data urodzenia - edytowalna -->
                <td>
                    {% if edit_id == pracownik.id and edit_field == 'data_urodzenia' and can_edit %}
                        <!-- TRYB EDYCJI -->
                        <form method="post" class="edit-form">
                            {% csrf_token %}
                            <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                            <input type="hidden" name="field_name" value="data_urodzenia">
                            <input type="date" 
                                   name="field_value" 
                                   value="{{ pracownik.data_urodzenia|date:'Y-m-d' }}" 
                                   class="edit-input"
                                   autofocus>
                            <div class="edit-actions">
                                <button type="submit" name="action" value="save" class="edit-btn save-btn">‚úì</button>
                                <a href="{% cancel_edit_url request %}" class="edit-btn cancel-btn">‚úó</a>
                            </div>
                        </form>
                    {% else %}
                        <!-- TRYB NORMALNY -->
                        {% if 'data_urodzenia' in user_editable_fields %}
                            <a href="{% edit_url request pracownik.id 'data_urodzenia' %}" class="edit-link">{{ pracownik.data_urodzenia }}</a>
                        {% else %}
                            {{ pracownik.data_urodzenia }}
                        {% endif %}
                    {% endif %}
                </td>
                
                <td>{{ pracownik.data_utworzenia|date:"Y-m-d H:i" }}</td>
                <td>{{ pracownik.data_modyfikacji|date:"Y-m-d H:i" }}</td>
                {% if can_delete_employees %}
                    <td>
                        <div style="display: flex; gap: 5px; align-items: center;">
                            <!-- Link do dokument√≥w -->
                            <a href="{% url 'upload_documents' pracownik.id %}" class="action-btn" title="ZarzƒÖdzaj dokumentami" style="text-decoration: none; color: #007bff;">üìÑ</a>
                            
                            {% if pracownik.id in deletable_employee_ids %}
                                <form method="post" style="display: inline;" onsubmit="return confirm('Czy na pewno chcesz usunƒÖƒá pracownika {{ pracownik.imie }} {{ pracownik.nazwisko }}?')">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="pracownik_id" value="{{ pracownik.id }}">
                                    <button type="submit" class="delete-btn">üóëÔ∏è</button>
                                </form>
                            {% else %}
                                <span style="color: #ccc;">-</span>
                            {% endif %}
                        </div>
                    </td>
                {% endif %}
            </tr>
            {% empty %}
            <tr>
                <td colspan="{% if can_delete_employees %}14{% else %}13{% endif %}" style="text-align: center; color: #666;">Brak pracownik√≥w w bazie</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="info">
        <p>≈ÅƒÖcznie pracownik√≥w: {{ pracownicy|length }}</p>
    </div>
    
    <!-- Chat Section -->
    <div class="chat-container">
        <div class="chat-header">
            <h3>üí¨ Komunikator zespo≈Çowy</h3>
            <p style="margin: 5px 0; color: #666; font-size: 14px;">Wiadomo≈õci wysy≈Çane w czasie rzeczywistym do wszystkich u≈ºytkownik√≥w</p>
        </div>
        <div id="chatMessages" class="chat-messages">
            <div class="chat-message">
                <strong>System:</strong> Komunikator gotowy do u≈ºycia
                <small style="color: #666; margin-left: 10px;">{{ now|date:"H:i" }}</small>
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="chatInput" placeholder="Napisz wiadomo≈õƒá..." onkeypress="if(event.key==='Enter') sendChatMessage()">
            <button onclick="sendChatMessage()">Wy≈õlij</button>
        </div>
    </div>
    
    <script>
        // Lista wszystkich formularzy i ich przycisk√≥w
        const forms = {
            'addEmployeeForm': 'addButton',
            'addStanowiskoForm': 'addStanowiskoButton',
            'addRolaForm': 'addRolaButton',
            'addZespolForm': 'addZespolButton'
        };

        function toggleForm(formId, buttonId) {
            const formToToggle = document.getElementById(formId);
            const buttonToToggle = document.getElementById(buttonId);

            // Zamknij wszystkie inne formularze
            for (const id in forms) {
                if (id !== formId) {
                    const otherForm = document.getElementById(id);
                    const otherButton = document.getElementById(forms[id]);
                    if (otherForm && otherForm.classList.contains('active')) {
                        otherForm.classList.remove('active');
                        // Przywr√≥ƒá oryginalny tekst przycisku
                        if (id === 'addEmployeeForm') otherButton.textContent = '+ Dodaj pracownika';
                        else if (id === 'addStanowiskoForm') otherButton.textContent = '+ Dodaj stanowisko';
                        else if (id === 'addRolaForm') otherButton.textContent = '+ Dodaj rolƒô';
                        else if (id === 'addZespolForm') otherButton.textContent = '+ Dodaj zesp√≥≈Ç';
                    }
                }
            }

            // Prze≈ÇƒÖcz widoczno≈õƒá wybranego formularza
            if (formToToggle.classList.contains('active')) {
                formToToggle.classList.remove('active');
                // Przywr√≥ƒá oryginalny tekst przycisku
                if (formId === 'addEmployeeForm') buttonToToggle.textContent = '+ Dodaj pracownika';
                else if (formId === 'addStanowiskoForm') buttonToToggle.textContent = '+ Dodaj stanowisko';
                else if (formId === 'addRolaForm') buttonToToggle.textContent = '+ Dodaj rolƒô';
                else if (formId === 'addZespolForm') buttonToToggle.textContent = '+ Dodaj zesp√≥≈Ç';
            } else {
                formToToggle.classList.add('active');
                buttonToToggle.textContent = 'Anuluj';
                formToToggle.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // WebSocket functionality
        let websocket = null;
        let reconnectInterval = null;

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws/pracownicy/`;
            
            websocket = new WebSocket(wsUrl);

            websocket.onopen = function(event) {
                console.log('WebSocket connected');
                clearInterval(reconnectInterval);
                
                // Wy≈õlij ping co 30 sekund, ≈ºeby utrzymaƒá po≈ÇƒÖczenie
                setInterval(() => {
                    if (websocket.readyState === WebSocket.OPEN) {
                        websocket.send(JSON.stringify({
                            type: 'ping'
                        }));
                    }
                }, 30000);
            };

            websocket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };

            websocket.onclose = function(event) {
                console.log('WebSocket disconnected');
                showNotification('Utracono po≈ÇƒÖczenie z systemem powiadomie≈Ñ', 'warning');
                
                // Spr√≥buj ponownie po≈ÇƒÖczyƒá co 5 sekund
                reconnectInterval = setInterval(() => {
                    console.log('Attempting to reconnect...');
                    connectWebSocket();
                }, 5000);
            };

            websocket.onerror = function(error) {
                console.error('WebSocket error:', error);
                showNotification('B≈ÇƒÖd po≈ÇƒÖczenia WebSocket', 'error');
            };
        }

        function handleWebSocketMessage(data) {
            switch(data.type) {
                case 'connection_established':
                    console.log('Connection established:', data.message);
                    break;
                    
                case 'chat_history':
                    loadChatHistory(data.messages);
                    break;
                    
                case 'employee_update':
                    showNotification(data.message, 'info');
                    // Od≈õwie≈º stronƒô po 2 sekundach, ≈ºeby pokazaƒá zmiany
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                    break;
                    
                case 'chat_message':
                    displayChatMessage(data);
                    break;
                    
                case 'system_notification':
                    showNotification(data.message, data.level);
                    break;
                    
                case 'pong':
                    console.log('Received pong:', data.message);
                    break;
                    
                default:
                    console.log('Unknown message type:', data.type);
            }
        }

        function showNotification(message, type = 'info') {
            // Usu≈Ñ poprzednie powiadomienia
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => notif.remove());

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">&times;</button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function displayChatMessage(data) {
            const chatContainer = document.getElementById('chatMessages');
            if (chatContainer) {
                const messageElement = document.createElement('div');
                messageElement.className = 'chat-message';
                messageElement.innerHTML = `
                    <strong>${data.user_name}:</strong> ${data.message}
                    <small style="color: #666; margin-left: 10px;">${data.timestamp}</small>
                `;
                chatContainer.appendChild(messageElement);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message && websocket && websocket.readyState === WebSocket.OPEN) {
                websocket.send(JSON.stringify({
                    type: 'broadcast_message',
                    message: message,
                    user_name: '{{ user.username|default:"Anonimowy" }}',
                    user_id: '{{ user.id|default:"" }}'
                }));
                input.value = '';
            }
        }

        function loadChatHistory(messages) {
            const chatContainer = document.getElementById('chatMessages');
            if (chatContainer) {
                // Wyczy≈õƒá istniejƒÖce wiadomo≈õci (opr√≥cz systemowej)
                const systemMessages = chatContainer.querySelectorAll('.chat-message');
                systemMessages.forEach(msg => {
                    if (!msg.textContent.includes('System:')) {
                        msg.remove();
                    }
                });
                
                // Dodaj wiadomo≈õci z historii
                messages.forEach(msg => {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'chat-message';
                    messageElement.innerHTML = `
                        <strong>${msg.user_name}:</strong> ${msg.message}
                        <small style="color: #666; margin-left: 10px;">${msg.timestamp}</small>
                    `;
                    chatContainer.appendChild(messageElement);
                });
                
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        // Inicjalizuj WebSocket po za≈Çadowaniu strony
        document.addEventListener('DOMContentLoaded', function() {
            connectWebSocket();
            loadNotifications();
        });
        
        // System powiadomie≈Ñ
        function loadNotifications() {
            fetch('/api/notifications/')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('notifications-container');
                    container.innerHTML = '';
                    
                    if (data.notifications && data.notifications.length > 0) {
                        data.notifications.forEach(notification => {
                            const notificationElement = document.createElement('div');
                            notificationElement.className = `notification-item ${notification.type}`;
                            notificationElement.innerHTML = `
                                <div class="notification-icon">${notification.icon}</div>
                                <div class="notification-content">
                                    <div class="notification-title">${notification.title}</div>
                                    <div class="notification-message">${notification.message}</div>
                                </div>
                            `;
                            container.appendChild(notificationElement);
                        });
                    }
                })
                .catch(error => console.log('B≈ÇƒÖd ≈Çadowania powiadomie≈Ñ:', error));
        }
        
        // Od≈õwie≈ºaj powiadomienia co 5 minut
        setInterval(loadNotifications, 5 * 60 * 1000);
    </script>
    </div> <!-- ZamykajƒÖcy div dla margin-top -->
</body>
</html>
